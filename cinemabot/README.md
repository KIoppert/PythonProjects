# CinemaBot

Сам бот лежит по ссылке: [@FilmsFinderYSDA_bot](https://t.me/FilmsFinderYSDA_bot)

### Использование бота

#### Начало

Для начала, необходимо ввести `/start`, чтобы зарегистрироваться
в БД, которой пользуется бот, чтобы поддерживать историю, статистику поиска и вишлист (ну и без этого он не даст делать
запросы).

После этого можно вводить названия фильмов и сериалов, чтобы получить информацию о них. Будет
выведена короткая справка с Кинопоиска, и две (возможно одна) ссылка на то, где можно посмотреть фильм/сериал.

#### Остальные команды

Все команды и что они делают увидеть, написав `/help`, но продублирую инфу и здесь:

- `/stats` - показывает самые часто запрашиваемые фильмы пользователем
- `/history` - показывает историю запросов
- `/clear` - очищает историю запросов и статистику, вишлист
- `/add_to_wishlist` - добавляет последний найденный фильм в вишлист
- `/wishlist` - показывает список фильмов, которые есть в вишлисте
- `/help` - показывает список команд

### Реализация

Бот написан на `aiogram` и использует `aiohttp` для асинхронных запросов. Для хранения данных используется `aiosqlite`
(больше асинхронщины, больше).

При получении запроса от пользователя, название фильма, которое он напишет, используется при обращении
к API Кинопоиска, чтобы получить информацию о фильме. После этого, используя `aiohttp`, бот ищет ссылки на фильм, по
полученному названию от Кинопоиска (так можно исправить некоторые опечатки в названии от пользователя и поиск в гугле
будет гарантированно по нужному фильму).
Делается два запроса в гугл вида: `<название от КП> смотреть на <lordfilms | rutube>`, ищутся первые три ссылки, и если
сайт открывается, то
отдается,
ссылка на этот сайт, иначе чекается вторая ссылка и т.д. Далее обновляется история и статистика. Еще можно написать
`/add_to_wishlist` и добавить последний найденный фильм в вишлист.

Время ответа бота на запросы - `~1.7-2` секунды.
